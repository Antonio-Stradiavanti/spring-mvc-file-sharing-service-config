server:
#  port: 8071
  port: ${GATEWAY_SERVER_PORT}


eureka:
  instance:
    preferIpAddress: true

  client:
    registerWithEureka: true
    fetchRegistry: true

    serviceUrl:
      defaultZone: ${EUREKA_SERVER_URI} 


spring:
  main: 
    web-application-type: reactive
  cloud:
    loadbalancer.ribbon.enabled: false
    gateway:
      routes:
      # lb -> load balancer
      # Просто идентификатор роута
      - id: file-sharing-s3-service
        # Идентификатор сервиса, зарегистрированного в eureka
        uri: lb://file-sharing-s3-service
        predicates:
        - Path=/s3/**

        filters:
        - RewritePath=/s3/(?<path>.*), /$\{path}
        - PrefixPath=/api/v1
        - AuthorizationFilter=ROLE_ADMIN


      - id: file-sharing-authentication-service
        uri: lb://file-sharing-security-service
        predicates:
        - Path=/auth/**

        filters:
        - PrefixPath=/api/v1


      - id: file-sharing-users-service
        uri: lb://file-sharing-security-service
        predicates:
        - Path=/users/**

        filters:
        - PrefixPath=/api/v1
        - AuthorizationFilter=ROLE_ADMIN


app:
  security:
    jwt:
      key: ${JWT_SECRET_KEY}

# actuator
management:
  endpoints:
    web:
      exposure:
        include: "*"

  endpoint:
    gateway:
      enabled: true

    health:
      show-details: always